<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
</head>
<body>
<h1 id="introdução"><span class="header-section-number">1</span> Introdução</h1>
<p><em>DBMS</em> significa <em>database management system</em> (sistema de gerenciamento de banco de dados - SGBD). Pode ser uma função simples, biblioteca ou mesmo um sistema maior composto por vários programas e processos executando separadamente e em paralelo, cuja função principal é gerenciar um ou vários bancos de dados hospedados em um servidor. Tem a responsabilidade de manipular e manter a consistência dos dados, permitindo que os desenvolvedores de software se concentrem em suas funcionalidades. Assim, praticamente qualquer sistema moderno que gerencia dados utiliza algum tipo de SGBD, independentemente da quantidade de informações armazenadas.</p>
<p>Os criadores do <strong>OmniDB</strong>, Rafael Thofehrn Castro e William Ivanski, trabalharam em uma empresa onde precisavam lidar com vários bancos de dados de diferentes clientes diariamente. Esses bancos de dados eram de diferentes tecnologias de SGBD, e então eles precisavam continuar alternando entre as ferramentas de gerenciamento de banco de dados (normalmente uma para cada SGBD). Como eles não tinham uma ferramenta de gerenciamento de banco de dados unificadas (que podem gerenciar diferentes SGBD), surgiram com a ideia principal do <strong>OmniDB</strong>.</p>
<p>A primeira versão da <strong>OmniDB</strong> foi apresentada como um projeto final de graduação no Curso de Ciência da Computação da Universidade Federal do Paraná, no Brasil. O objetivo era traçar uma linha comum entre os SGBD populares e como tratavam seus metadados. O resultado foi uma ferramenta escrita em ASP.NET/C# capaz de conectar e identificar as estruturas principais (tabelas, chaves, índices e restrições), de forma genérica, de vários SGBDs:</p>
<ul>
<li>Firebird</li>
<li>MariaDB / MySQL</li>
<li>Oracle</li>
<li>PostgreSQL</li>
<li>SQLite</li>
<li>Microsoft SQL Server</li>
</ul>
<p>A primeira versão do OmniDB também permitiu a conversão entre todos os SGBDs suportados pela ferramenta. Este recurso foi desenvolvido para ser amigável, exigindo apenas algumas etapas: o usuário precisa selecionar uma conexão de origem, as estruturas que seriam convertidas (apenas tabelas e todas as suas estruturas, junto com seus dados) e a conexão de destino.</p>
<p>Desde o início do desenvolvimento, o OmniDB foi projetado como um aplicativo Web. Consequentemente, ele é executado em qualquer navegador, a partir de qualquer sistema operacional. Pode ser acessado por vários computadores e vários usuários, cada um deles com o seu próprio grupo de conexões. Também pode ser hospedado em qualquer sistema operacional, sem a necessidade de instalar quaisquer dependências. Veremos mais detalhes sobre a instalação nos próximos capítulos.</p>
<p>O objetivo principal do OmniDB é oferecer um espaço de trabalho unificado com todas as funcionalidades necessárias para manipular diferentes SGBDs. As ferramentas específicas do SGBD não são necessárias: no OmniDB, alternar entre diferentes SGBDs é feito com um simples interruptor de conexão, sem sair da mesma página. O usuário final tem a sensação de que não há diferença quando ele / ela manipula diferentes SGBDs, ele simplesmente se sente trabalhando com diferentes conexões.</p>
<p>Apesar disso, o OmniDB foi construído com a simplicidade em mente, projetado para ser uma aplicação web leve e veloz. OmniDB também é alimentado pelo WebSocket Technology, permitindo ao usuário executar múltiplas consultas e procedimentos em vários bancos de dados, em vários hosts, em segundo plano.</p>
<p>OmniDB também é seguro. Todos os dados do usuário OmniDB são armazenados criptografados e não salva a senha onde o banco de dados está armazenado. Quando o usuário se conecta pela primeira vez a um banco de dados, OmniDB solicita a senha. Esta senha é criptografada e armazenada em memória por um período específico de tempo. Quando esse prazo expirar, OmniDB pergunta novamente a senha. Isso garante a máxima segurança para o banco de dados que o OmniDB está se conectando.</p>
<h1 id="instalação"><span class="header-section-number">2</span> Instalação</h1>
<p>OmniDB fornece 2 tipos de pacotes para atender a todas as necessidades dos usuários:</p>
<ul>
<li><strong>OmniDB Application</strong>: Executa um servidor web em uma porta aleatória para trás, e fornece uma janela simplificada do servidor web para usar a interface OmniDB sem qualquer configuração adicional. Funciona como uma aplicação de desktop.</li>
<li><strong>OmniDB Server</strong>: executa um servidor web em uma porta aleatória. O usuário necessita de um navegador Web para se conectar. Fornece gerenciamento de usuários e é ideal para ser hospedado em um servidor na rede dos usuários.</li>
</ul>
<p>Tanto o OmniDB Application quanto o OmniDB Server podem ser instalados na mesma máquina.</p>
<h2 id="omnidb-application"><span class="header-section-number">2.1</span> OmniDB Application</h2>
<p>Para executar o aplicativo OmniDB, você não precisa instalar nenhuma peça adicional de software. Basta dirigir-se a <a href="omnidb.org" class="uri">omnidb.org</a> e baixar o pacote mais recente para seu sistema operacional específico e arquitetura:</p>
<pre><code>• Linux 32 bits / 64 bits
    - instalador DEB
    - instalador RPM
    - Tarball

• Windows 32 bits / 64 bits
    - instalador EXE
    - pacote ZIP

• Mac OS X
    - Instalador DMG
    - pacote ZIP</code></pre>
<p>Se você escolhe pacotes tarball ou zip, basta extraí-lo em algum lugar do seu computador. Entre na pasta criada e abra o executável do <code>omnidb-app</code>. Ele abrirá OmniDB dentro de sua própria janela.</p>
<p>Com o instalador, você pode instalar o OmniDB no seu sistema, e estará disponível através do menu do seu aplicativo de ambiente de trabalho. Quando você abri-lo o OmniDB abrirá sua própria janela.</p>
<p><img src="../img/03_installation_01.png" /></p>
<h2 id="omnidb-server"><span class="header-section-number">2.2</span> OmniDB Server</h2>
<p>Como o OmniDB app, o OmniDB Server não requer nenhuma peça adicional de software e as mesmas opções para sistema operacional e arquitetura são fornecidas. Se você escolher o tarball ou o pacote zip, extraia-o em algum lugar do seu computador. Entre na pasta descompactada e abra o executável <code>omniDB-server</code>.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">user@machine</span>:~$ cd omnidb-server
<span class="ex">user@machine</span>:~$ ./omnidb-server
<span class="ex">Starting</span> OmniDB websocket...
<span class="ex">Checking</span> port availability...
<span class="ex">Starting</span> websocket server at port 25482.
<span class="ex">Starting</span> OmniDB server...
<span class="ex">Checking</span> port availability...
<span class="ex">Starting</span> server OmniDB 2.0.4 at http://localhost:8000.
<span class="ex">Open</span> OmniDB in your favorite browser
<span class="ex">Press</span> Ctrl+C to exit</code></pre></div>
<p>Para instalar o OmniDB Server, você precisará de privilégios de administrador:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">user@machine</span>:~$ sudo omnidb-server
<span class="ex">Starting</span> OmniDB websocket...
<span class="ex">Checking</span> port availability...
<span class="ex">Starting</span> websocket server at port 25482.
<span class="ex">Starting</span> OmniDB server...
<span class="ex">Checking</span> port availability...
<span class="ex">Starting</span> server OmniDB 2.0.3 at http://localhost:8000.
<span class="ex">Open</span> OmniDB in your favorite browser
<span class="ex">Press</span> Ctrl+C to exit</code></pre></div>
<p>Observe como o OmniDB inicia um <em>servidor de websocket</em> em uma porta aleatória (no exemplo acima, começou na porta 25482) e um <em>servidor web</em> na porta 8000. Você pode até mesmo iniciar múltiplas instâncias do omnidb-server, e usar diferentes portas para evitar conflitos. Você também pode especificar as portas do <em>servidor de websocket</em> e a do <em>servidor web</em>:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">user@machine</span>:~$ sudo omnidb-server -p 8080 -w 2000
<span class="ex">Starting</span> OmniDB websocket...
<span class="ex">Checking</span> port availability...
<span class="ex">Starting</span> websocket server at port 2000.
<span class="ex">Starting</span> OmniDB server...
<span class="ex">Checking</span> port availability...
<span class="ex">Starting</span> server OmniDB 2.0.4 at http://localhost:8080.
<span class="ex">Open</span> OmniDB in your favorite browser
<span class="ex">Press</span> Ctrl+C to exit</code></pre></div>
<p>Agora que o servidor web está em execução, você pode acessar o aplicativo da web OmniDB em seu navegador favorito. Digite na barra de endereços: <code>localhost: 8000</code> e tecle <code>Enter</code>. Se tudo correu bem, você verá uma página como esta:</p>
<p><img src="../img/03_installation_02.png" /></p>
<p>Agora você sabe que o OmniDB está funcionando corretamente. Nos próximos capítulos, nós veremos como fazer o login pela primeira vez, como criar um usuário e utilizar OmniDB.</p>
<h1 id="criando-usuários-e-conexões"><span class="header-section-number">3</span> Criando Usuários e Conexões</h1>
<h2 id="efetuando-login-como-usuário-admin"><span class="header-section-number">3.1</span> Efetuando login como usuário <em>admin</em></h2>
<p>O OmniDB vem apenas com o usuário <em>admin</em>. Se você estiver usando a versão do servidor, a primeira coisa é fazer login como <em>admin</em>, a senha padrão é <em>admin</em>. Você não precisa fazer login na versão do aplicativo.</p>
<p><img src="../img/04_creating_users_and_connections_01.png" /></p>
<p>A próxima janela é a janela <strong>Connections</strong>. Vamos falar sobre isso mais tarde.</p>
<p><img src="../img/04_creating_users_and_connections_02.png" /></p>
<h2 id="criando-outro-usuário"><span class="header-section-number">3.2</span> Criando outro Usuário</h2>
<p>Clique no ícone <em>Users</em> no canto superior direito. Ele abrirá um pop-up que permite que o super usuário OmniDB atual crie um novo usuário OmniDB.</p>
<p><img src="../img/04_creating_users_and_connections_03.png" /></p>
<p>Após clicar no ícone <em>New User</em>, a ferramenta insere um novo usuário chamado <em>user2</em> (se esse é o primeiro usuário após o <em>admin</em>).</p>
<p><img src="../img/04_creating_users_and_connections_04.png" /></p>
<p>Você terá que mudar <em>username</em> e <em>password</em>. Marque se você deseja que o novo usuário seja um super usuário. Esta janela de gerenciamento de usuários só é acessada por super usuários. Quando terminar, clique no botão <em>Save Data</em> dentro do pop-up.</p>
<p><img src="../img/04_creating_users_and_connections_05.png" /></p>
<p>Você pode criar tantos usuários quanto quiser, editar usuários existentes e também excluir usuários clicando na cruz vermelha na coluna Actions. Agora você pode sair.</p>
<h2 id="logando-como-novo-usuário"><span class="header-section-number">3.3</span> Logando como novo usuário</h2>
<p>Vamos logar como o usuário que acabamos de criar.</p>
<p><img src="../img/04_creating_users_and_connections_06.png" /></p>
<p>E podemos ver a janela <strong>Connections</strong> novamente. Observe que agora não há o ícone <em>Users</em>, porque o usuário de teste não é um super usuário.</p>
<p><img src="../img/04_creating_users_and_connections_07.png" /></p>
<h2 id="criando-conexões"><span class="header-section-number">3.4</span> Criando conexões</h2>
<p>O OmniDB versão C# suporta vários SGBDs. No momento, o OmniDB versão Python, ou <code>OmniDB 2.0</code>, suporta apenas o PostgreSQL. O suporte a mais SGBDs está sendo adicionado enquanto você lê isso.</p>
<p>Agora vamos criar duas conexões aos bancos de dados PostgreSQL. Para criar as conexões você deve clicar no botão <em>New Connection</em> e, em seguida, escolher a conexão e preencher os outros campos. Depois de preencher todos os campos para ambas as conexões, clique no botão <em>Save Data</em>.</p>
<p><img src="../img/04_creating_users_and_connections_08.png" /></p>
<p>Para cada conexão há uma coluna <em>Actions</em> onde você pode excluir, testar e seleciona-la. Vá em frente e teste uma das conexões.</p>
<p><img src="../img/04_creating_users_and_connections_09.png" /></p>
<p>Observe o menu pop-up <em>Password Expired</em>. Isso está acontecendo porque OmniDB não armazena a senha do usuário do banco de dados no disco. Quando o usuário digita uma senha neste pop-up, a senha é criptografada e armazenada na memória.</p>
<p>Após digitar a senha e pressionar <em>Enter</em>, se a conexão ao banco de dados for bem sucedida você verá um pop-up de confirmação.</p>
<p><img src="../img/04_creating_users_and_connections_10.png" /></p>
<p>Mas, se você tiver problemas de qualquer tipo na conexão ao seu banco de dados PostgreSQL, o pop-up <em>Password Expired</em> continuará mostrando o erro que o OmniDB obteve.</p>
<p><img src="../img/04_creating_users_and_connections_11.png" /></p>
<p>Além disso, na grade de conexões, se você clicar na ação <em>Select Connection</em>, o OmniDB irá abrir na janela <em>Workspace</em>.</p>
<h1 id="gerenciando-banco-de-dados"><span class="header-section-number">4</span> Gerenciando Banco de Dados</h1>
<p>Após criar pelo menos uma conexão, o usuário pode entrar no <em>Workspace</em>, seja clicando na guia <em>Workspace</em> ou clicando na ação <em>Select Connection</em> na grade de conexões.</p>
<p><img src="../img/05_workspace_01.png" /></p>
<h2 id="seções-da-janela-workspace"><span class="header-section-number">4.1</span> Seções da janela <em>Workspace</em></h2>
<p>Esta interface possui vários elementos:</p>
<p><img src="../img/05_workspace_02.png" /></p>
<ul>
<li><strong>1) Links</strong>: permite ao usuário navegar entre as janelas do OmniDB</li>
<li><strong>2) Abas Externas</strong>: OmniDB permite que você trabalhe com vários bancos de dados ao mesmo tempo. Cada banco de dados será acessível através de uma aba externa. As abas externas também podem conter recursos diversos, como o recurso <em>Snippets</em></li>
<li><strong>3) Opções</strong>: mostra o usuário atual logado, e também links para <em>user settings</em>, <em>query history</em>, <em>information</em> e <em>logout</em>.</li>
</ul>
<h2 id="aba-externa-de-conexão"><span class="header-section-number">4.2</span> Aba Externa de Conexão</h2>
<p>Então, a aba externa chamada <em>Test</em> tem esse nome por causa do alias que colocamos na conexão ao <code>testdb</code>. Esta aba é uma <em>aba de conexão externa</em>. Observe a pequena aba com uma cruz além da aba <em>Test</em>. Ela permite que você crie uma nova aba externa que será automaticamente uma <em>aba externa de conexão</em>. No entanto, a <em>aba externa Snippet</em> é fixa e sempre será a primeira. Uma nova <em>aba externa de conexão</em> sempre apontará automaticamente para a primeira conexão em sua lista de conexões de banco de dados. Ou, se você clicar no <em>Selection Connection</em>, ela apontará para a conexão selecionada. Observe os elementos dentro desta guia:</p>
<p><img src="../img/05_workspace_04.png" /></p>
<ul>
<li><strong>1) Seletor de conexão</strong>: mostra todas as conexões e permite ao usuário selecionar a atual</li>
<li><strong>2) Árvore de estruturas</strong>: exibe uma árvore hierárquica onde você pode navegar pelos elementos do banco de dados</li>
<li><strong>3) Abas Internas</strong>: Permite que o usuário execute ações na corrente base de dados. Existem vários tipos de abas internas para o banco de dados atual. Ao clicar na última aba com uma cruz, você pode adicionar uma nova aba. Uma nova aba sempre será uma <em>aba de consulta</em>, onde você pode escrever qualquer tipo de declaração SQL</li>
<li><strong>4) Conteúdo da aba interna</strong>: pode variar de acordo com o tipo de aba interna. A figura mostra uma <em>aba de consulta</em> e, neste caso, o conteúdo será um <em>Editor de SQL</em>, com destaque de sintaxe e preenchimento automático</li>
<li><strong>5) Ações da aba interna</strong>: pode variar dependendo do tipo de aba interna. Para uma <em>aba de consulta</em>, eles são: <em>Execute Button</em>, <em>Format Button</em> e <em>Editor Mode</em> (script, executar ou consulta)</li>
<li><strong>6) Resultados da aba interna</strong>: uma <em>aba de consulta</em> no modo de consulta, depois de clicar no botão <em>Execute</em> ou digitar o atalho de execução (<code>Alt-Q</code>), mostrará uma grade com os resultados da consulta. Todos os modos mostrarão mensagens de erro, se houver.</li>
</ul>
<h2 id="trabalhando-com-banco-de-dados"><span class="header-section-number">4.3</span> Trabalhando com banco de dados</h2>
<p>Dê uma olhada em seu seletor de conexões. OmniDB sempre aponta para a primeira conexão disponível, mas você pode alterá-lo clicando no seletor.</p>
<p><img src="../img/05_workspace_05.png" /></p>
<p>Selecione a conexão <em>DellStore</em>. Agora vá para a árvore logo abaixo do seletor e clique para expandir o nó <em>Schemas</em>.</p>
<p><img src="../img/05_workspace_06.png" /></p>
<p>Tenha em mente que a cada 10 minutos sem executar ações no banco de dados, irá ativar um pop-up <em>Password Expired</em>. Como explicado anteriormente, isso é importante para a segurança do seu banco de dados. Depois de digitar a senha correta, você verá todos os schemas no seu banco de dados (no caso do PostgreSQL, TOAST e temp schemas não são mostrados).</p>
<p><img src="../img/05_workspace_07.png" /></p>
<p>Agora, clique para expandir o schema <code>public</code>. Você verá diferentes tipos de elementos contidos neste schema.</p>
<p><img src="../img/05_workspace_08.png" /></p>
<p>Agora clique para expandir o nó <em>Tables</em>, e você verá todas as tabelas contidas no schema <code>public</code>. Expanda qualquer tabela e você verá suas colunas, chave primária, chaves estrangeiras, restrições e índices únicos. Cada coluna é também expansível, apresentando tipo de dados e restrição anulável.</p>
<p><img src="../img/05_workspace_09.png" /></p>
<p>Para ver registros dentro de uma tabela, clique com o botão direito e escolha <em>Data Actions &gt; Query Data</em>.</p>
<p><img src="../img/05_workspace_10.png" /></p>
<p>Observe que o OmniDB preenche o editor atual do SQL com uma consulta simples para listar os registros da tabela. Os registros são exibidos em uma grade logo abaixo do editor. Esta grade pode ser controlada com o teclado como se estivesse usando uma planilha. Você também pode copiar dados de células únicas ou blocos de células (que pode ser selecionado com o teclado ou mouse) e colar em qualquer planilha.</p>
<p><img src="../img/05_workspace_11.png" /></p>
<p>Você pode editar a consulta no editor do SQL, escrevendo simples ou complexas consultas e executá-las clicando no botão action. Você pode controlar quantos registros devem ser exibidos (10, 100, 1000 ou todas as linhas). Mais detalhes nos próximos capítulos.</p>
<h2 id="trabalhando-com-abas-múltiplas-dentro-da-mesma-conexão"><span class="header-section-number">4.4</span> Trabalhando com abas múltiplas dentro da mesma conexão</h2>
<p>Dentro de uma única conexão, você pode criar várias abas internas clicando na última aba com uma cruz. Cada nova aba interna será uma <em>aba de consulta</em>.</p>
<p><img src="../img/05_workspace_12.png" /></p>
<p>No OmniDB, você pode executar várias instruções SQL e procedimentos em paralelo. Quando está sendo executado, um ícone será mostrado na aba para indicar o estado atual. Se algum processo estiver concluído e não estiver na aba atual, essa aba mostrará um ícone verde para indicar que a rotina que está sendo executada agora terminou.</p>
<p><img src="../img/05_workspace_13.png" /></p>
<p>Ao clicar no botão <em>Cancel</em>, você pode cancelar um processo que está sendo executado dentro do banco de dados.</p>
<p><img src="../img/05_workspace_14.png" /></p>
<p>Você também pode arrastar e soltar uma guia para alterar sua ordem. Isso funciona com as abas internas e externas.</p>
<p><img src="../img/05_workspace_15.png" /></p>
<p>Além disso, você pode usar atalhos de teclado para gerenciar abas internas (Consulta SQL) e abas externas (Conexão): - <strong>Ctrl-Insert</strong>: Insere uma nova aba interna - <strong>Ctrl-Delete</strong>: remove uma aba interna - <strong>Ctrl- &lt;</strong>: Muda o foco para a aba interna à esquerda - <strong>Ctrl- &gt;</strong>: Muda o foco para a aba interna à direita - <strong>Ctrl-Shift-Insert</strong>: Insere uma nova aba externa - <strong>Ctrl-Shift-Delete</strong>: remove uma aba externa - <strong>Ctrl-Shift- &lt;</strong>: Muda o foco para a aba externa à esquerda - <strong>Ctrl-Shift- &gt;</strong>: Muda o foco para a aba externa à direita</p>
<h1 id="criando-alterando-e-removendo-tabelas"><span class="header-section-number">5</span> Criando, Alterando e Removendo Tabelas</h1>
<h2 id="criando-tabelas"><span class="header-section-number">5.1</span> Criando tabelas</h2>
<p>OmniDB possui uma interface de criação de tabelas que permite configurar colunas, restrições (constraints) e índices. Algumas observações devem ser mencionadas: - A maioria dos SGBDs cria automaticamente índices quando as chaves primárias e exclusivas são criadas. Por isso, a guia de índices só está disponível depois de criar a tabela. - Cada SGBD tem suas características e limitações únicas na criação de tabelas e a interface OmniDB reflete essas limitações. Por exemplo, o SQLite não nos permite alterar as colunas existentes e restrições (constraints). Por isso, a interface nos permite mudar apenas o nome da tabela e adicionar novas colunas ao lidar com bancos de dados SQLite (este ainda não é o caso da versão OmniDB Python, pois atualmente suporta apenas banco de dados PostgreSQL).</p>
<p>Vamos criar tabelas de exemplo (<em>Customer</em> e <em>Address</em>) no banco de dados <code>testdb</code> que conectamos anteriormente. Clique com o botão direito do mouse no nó <strong>Tables</strong> e selecione <strong>New Table</strong>:</p>
<p><img src="../img/06_table_management_01.png" /></p>
<p>Vamos criar a tabela <em>Customer</em> com uma chave primária que será referenciada pela Tabela <em>Address</em>:</p>
<p><img src="../img/06_table_management_02.png" /></p>
<p><img src="../img/06_table_management_03.png" /></p>
<p>Observe como a tabela aparece no nó <em>Tables</em> da árvore:</p>
<p><img src="../img/06_table_management_04.png" /></p>
<p>Agora, crie a tabela <em>Address</em> com uma chave primária e uma chave estrangeira.</p>
<p><img src="../img/06_table_management_05.png" /></p>
<p><img src="../img/06_table_management_06.png" /></p>
<p>Neste ponto, temos duas tabelas no schema <code>public</code>. A estrutura do schema pode ser vista com o recurso de gráfico clicando com o botão direito no schema <code>public</code> da árvore e selecionando <em>Render Graph &gt; Simple Graph</em>: At this point we have two tables in schema <code>public</code>. The schema structure can be seen with the graph feature by right clicking on the schema <code>public</code> node of the tree and selecting <em>Render Graph &gt; Simple Graph</em>:</p>
<p><img src="../img/06_table_management_07.png" /></p>
<p><img src="../img/06_table_management_08.png" /></p>
<p>E é assim que o <em>Complete Graph</em> exibe:</p>
<p><img src="../img/06_table_management_09.png" /></p>
<h2 id="editando-tabelas"><span class="header-section-number">5.2</span> Editando tabelas</h2>
<p>O OmniDB também permite que você edite tabelas existentes (sempre seguindo as limitações do SGBD). Para testar este recurso, adicionaremos uma nova coluna à tabela <em>Customer</em>. Para acessar a interface alter table apenas clique com o botão direito do mouse no nó da tabela e selecione <em>Table Actions &gt; Alter Table</em>:</p>
<p><img src="../img/06_table_management_10.png" /></p>
<p>Adicione a coluna <em>cust_age</em> e salve:</p>
<p><img src="../img/06_table_management_11.png" /></p>
<p>A interface é capaz de detectar erros que podem ocorrer durante as operações Alter Table, mostrando o comando e o erro que ocorreu. Para demonstrar tentaremos adicionar a coluna <em>cust_name</em>, que já pertence a esta tabela:</p>
<p><img src="../img/06_table_management_12.png" /></p>
<h2 id="removendo-tabelas"><span class="header-section-number">5.3</span> Removendo tabelas</h2>
<p>Para remover uma tabela, clique com o botão direito do mouse no nó da tabela e selecione <em>Table Actions &gt; Drop Table</em>:</p>
<p><img src="../img/06_table_management_13.png" /></p>
<h1 id="gerenciando-dados-da-tabela"><span class="header-section-number">6</span> Gerenciando Dados da Tabela</h1>
<p>A ferramenta nos permite editar os registros contidos nas tabelas através de uma simples e intuitiva interface. Como apenas alguns SGBDs têm identificadores únicos para registros de tabelas, optamos por permitir a edição e remoção de dados apenas para tabelas que possuem chaves primárias. Tabelas que não o possuem podem receber apenas novas registros.</p>
<p>Para acessar a interface de edição de registro, clique com o botão direito do mouse no nó da tabela e selecione <em>Data Actions &gt; Edit Data</em>:</p>
<p><img src="../img/07_data_management_01.png" /></p>
<p><img src="../img/07_data_management_02.png" /></p>
<p>A interface possui um editor SQL onde você pode filtrar e ordenar registros. Para evitar que a interface solicite muitos registros, há um campo que limita o número de registros a serem exibidos. A grade de registros tem as colunas nomes e tipos de dados. Colunas que pertencem à chave primária têm um ícone de uma chave ao lado de seus nomes.</p>
<p>A linha da grade que tem o símbolo <code>*</code> é a linha para adicionar novos registros. Vamos inserir alguns registros na tabela <code>Customer</code>:</p>
<p><img src="../img/07_data_management_03.png" /></p>
<p>Após salvar, os registros serão inseridos e podem ser editados (somente porque esta tabela possui uma chave primária). Vamos alterar o <em>cust_name</em> de alguns dos registros existentes:</p>
<p><img src="../img/07_data_management_04.png" /></p>
<p>As tabelas podem ter campos com valores representados por strings muito longas. Para editar estes campos, o OmniDB possui uma interface que pode ser acessada clicando na célula específica:</p>
<p><img src="../img/07_data_management_05.png" /></p>
<p><img src="../img/07_data_management_06.png" /></p>
<p>A interface detecta erros que podem ocorrer durante as operações relacionadas a registros. Para demonstrar, insira dois registros com <code>cust_id</code> (chave primária) existente:</p>
<p><img src="../img/07_data_management_07.png" /></p>
<p>Mostra quais comandos tentaram ser executados e os respectivos erros. Para completar este capítulo, vamos adicionar alguns registros à tabela <em>Address</em>:</p>
<p><img src="../img/07_data_management_08.png" /></p>
<h1 id="escrevendo-consultas-sql"><span class="header-section-number">7</span> Escrevendo Consultas SQL</h1>
<p>A ferramenta vem com um sistema de tabulação onde cada guia contém um editor SQL, um botão de ação, um botão de recuo, um campo para selecionar o tipo de comando e um espaço para exibir o resultado.</p>
<p>O editor SQL possui um recurso que ajuda muito ao criar novas consultas: <em>SQL code completion</em>. Com esta funcionalidade, é possível preencher automaticamente colunas contidas em uma tabela referenciada por um Alias (apelido). Para abrir a interface de preenchimento automático você só precisa digitar o Alias (apelido) e, em seguida, o caractere de ponto ( . ):</p>
<p><img src="../img/08_sql_editor_01.png" /></p>
<p>Além de preencher automaticamente as colunas da tabela, o editor também procura colunas contidas em subquery (sub-consultas):</p>
<p><img src="../img/08_sql_editor_02.png" /></p>
<p>O campo para selecionar o tipo de comando possui as seguintes opções: - <strong>Script</strong>: execução de script, que é uma sequência de comandos separados por ponto e vírgula ( ; ):</p>
<p><img src="../img/08_sql_editor_03.png" /></p>
<p>O retorno mostra o tempo de resposta, o número de comandos que foram executados com sucesso, o número de comandos que geraram erros e um lista mostrando cada erro. - <strong>Execute</strong>: execução de um único comando. O retorno mostra o tempo de resposta ou um erro. - <strong>Query (10, 100, 1000, all) rows</strong>: execução de uma consulta que retorna um conjunto de registros, que são exibidos em uma grade. Assim como na interface de edição de registro onde cada célula pode ser visualizada separadamente clicando com o botão direito do mouse:</p>
<p><img src="../img/08_sql_editor_04.png" /></p>
<h1 id="visualizando-dados"><span class="header-section-number">8</span> Visualizando Dados</h1>
<p>Este recurso exibe um gráfico com nós que representam tabelas e arestas representando os relacionamentos de tabelas com chaves estrangeiras. Usando o mouse, o usuário é capaz de aumentar o zoom, diminuir o zoom e arrastar e soltar nós para mudar sua posição.</p>
<p>Existem dois tipos de gráficos: <em>Simple Graph</em> (Gráfico simples) e <em>Complete Graph</em> (Gráfico completo).</p>
<h2 id="gráfico-simples"><span class="header-section-number">8.1</span> Gráfico simples</h2>
<p>Para acessá-lo, clique com o botão direito do mouse no nó da raiz da árvore e selecione <em>Render Graph &gt; Simple Graph</em>:</p>
<p><img src="../img/09_graphs_with_tables_and_relations_01.png" /></p>
<p><img src="../img/09_graphs_with_tables_and_relations_02.png" /></p>
<h2 id="gráfico-completo"><span class="header-section-number">8.2</span> Gráfico Completo</h2>
<p>Este gráfico exibe tabelas com todas as suas colunas e respectivos tipos de dados. Além disso, as arestas agora são rotuladas com informações sobre a chave estrangeira específica. Para acessá-lo, clique com o botão direito do mouse no nó da raiz da árvore e selecione <em>Render Graph &gt; Complete Graph</em>:</p>
<p><img src="../img/09_graphs_with_tables_and_relations_03.png" /></p>
<p><img src="../img/09_graphs_with_tables_and_relations_04.png" /></p>
<h1 id="gerenciando-outros-elementos-do-postgresql"><span class="header-section-number">9</span> Gerenciando outros elementos do PostgreSQL</h1>
<p>Com exceção das tabelas, todas as estruturas do PostgreSQL podem ser gerenciadas com o uso de <em>modelos SQL</em>. Isso dá ao usuário mais poder do que usando formas gráficas para manipular estruturas. Por exemplo, vamos considerar as sequências dentro do schema <code>public</code> do banco de dados <code>testdb</code>. Para criar uma nova seqüência, clique com o botão direito do mouse no nó <em>Sequences</em> e escolha <em>New Sequence</em>.</p>
<p><img src="../img/10_sql_templates_01.png" /></p>
<p><img src="../img/10_sql_templates_02.png" /></p>
<p>Depois de alterar o nome da sequência, você pode descomentar outras opções de comando e configura-las de acordo com suas necessidades. Quando todos os comandos estiverem corretos, você pode clicar no botão <em>Execute</em> e uma nova sequência será criada:</p>
<p><img src="../img/10_sql_templates_03.png" /></p>
<p>Com o clique direito em uma sequência existente, você pode alterá-la ou soltar. Será feito da mesma maneira que a criação, usando um modelo SQL para o usuário efetuar a mudança.</p>
<p><img src="../img/10_sql_templates_04.png" /></p>
<p><img src="../img/10_sql_templates_05.png" /></p>
<p><img src="../img/10_sql_templates_06.png" /></p>
<h1 id="funcionalidades-adicionais"><span class="header-section-number">10</span> Funcionalidades Adicionais</h1>
<h2 id="histórico-sql"><span class="header-section-number">10.1</span> Histórico SQL</h2>
<p>Toda interação que o usuário faz com cada banco de dados é registrada no <em>Histórico SQL</em> do OmniDB. Para acessá-lo, você precisa clicar no ícone do relógio no canto superior direito. OmniDB mostrará um pop-up com todas as ações em um página de grade.</p>
<p><img src="../img/11_additional_features_01.png" /></p>
<p>Cada ação mostra a hora e a data em que começou, o tempo que terminou, a duração, o modo, o status e o comando. Como toda grade no OmniDB, você pode clicar com o botão direito no comando e clique em <em>View Content</em> (Exibir Conteúdo), onde outro pop-up irá abrir mostrando o conteúdo em um editor de texto maior.</p>
<h2 id="configurações-do-usuário"><span class="header-section-number">10.2</span> Configurações do usuário</h2>
<p>Também no canto superior direito, clicando no ícone de engrenagem, o OmniDB irá abrir o pop-up <em>User Settings</em> (Configurações do usuário). É composto por duas abas: - <strong>User (Usuário)</strong>: permite que o usuário altere sua senha. Mais configurações do usuário serão adicionadas no futuro. - <strong>Editor</strong>: permite ao usuário alterar o tamanho da fonte do Editor SQL e também altera todo o tema OmniDB. Há vários temas para OmniDB, cada um deles altera a cor de destaque de sintaxe do editor. Eles também são classificados em temas claros e escuros. Um tema leve é o padrão; um tema escuro mudará toda a interface do OmniDB.</p>
<p><img src="../img/11_additional_features_02.png" /></p>
<p>Todas as alterações nas configurações do usuário exigem que você: - Atualize a página, se você estiver usando o OmniDB Server e a interface através de um navegador web; ou - Abra e feche o OmniDB, se você estiver usando o OmniDB-app.</p>
<p><img src="../img/11_additional_features_03.png" /></p>
<p><img src="../img/11_additional_features_04.png" /></p>
<h1 id="ferramenta-de-configuração-do-omnidb"><span class="header-section-number">11</span> Ferramenta de Configuração do OmniDB</h1>
<p>Toda instalação do OmniDB também vem com um pequeno utilitário CLI chamado <em>OmniDB Config</em>. Ele terá um nome de arquivo diferente, dependendo da maneira como você instalou o OmniDB: - Se você estiver usando um pacote tarball ou zip, ele é chamado <strong>omnidb-config</strong>, para ambas versões: Server e app; - Se você usou um instalador (como o arquivo .deb) da versão Server, ele é chamado <strong>Omnidb-config-server</strong>; - Se você usou um instalador da versão app, ele é chamado <strong>omnidb-config-app</strong>.</p>
<p>Apesar de ter nomes diferentes, o utilitário faz exatamente o mesmo. Se você usou um instalador, ele será colocado no seu <code>$PATH</code>.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">user@machine</span>:~$  omnidb-config-app --help
<span class="ex">Usage</span>: omnidb-config-app [options]

<span class="ex">Options</span>:
  <span class="ex">--version</span>             show program<span class="dt">\&#39;</span>s version number and exit
  <span class="ex">-h</span>, --help            show this help message and exit
  <span class="ex">-c</span> username password, --createsuperuser=username password
                        <span class="ex">create</span> super user: -c username password
  <span class="ex">-a</span>, --vacuum          databases maintenance
  <span class="ex">-r</span>, --resetdatabase   reset databases</code></pre></div>
<h2 id="criar-super-usuário"><span class="header-section-number">11.1</span> Criar Super Usuário</h2>
<p>Opção <code>-c</code> permite que você crie um novo super usuário, sem precisar abrir Interface OmniDB.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">user</span> @ machine: ~ $ omnidb-config-app -c william password
<span class="ex">Criando</span> o superusuário ...
<span class="ex">Superuser</span> criado.</code></pre></div>
<h2 id="vacuum"><span class="header-section-number">11.2</span> Vacuum</h2>
<p>O OmniDB possui dois bancos de dados: - <code>omnidb.db</code>: armazena todos os usuários e conexões, e outros relacionados ao OmniDB - <em>Session database</em>: armazena sessões de usuário do Django.</p>
<p>Ambos os bancos de dados são SQLite, por isso pode ser útil otimizá-los às vezes para reduzir o tamanho do arquivo. Isso pode ser feito com a opção <code>-a</code>.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">user</span> @ machine: ~ $ omnidb-config-app -a
<span class="ex">Vacuuming</span> OmniDB database ...
<span class="ex">Done.</span>
<span class="ex">Vacuuming</span> Sessions database...
<span class="ex">Done.</span></code></pre></div>
<h2 id="redefinir-o-banco-de-dados"><span class="header-section-number">11.3</span> Redefinir o Banco de Dados</h2>
<p>Se deseja eliminar todas as informações do OmniDB e obter um banco de dados limpo, conforme foi instalado, você pode usar a opção <code>-r</code>. Use com cuidado!</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">user@machine</span>:~$ omnidb-config-app -r
<span class="ex">***</span> ATENTION *** ALL USERS DATA WILL BE LOST
<span class="ex">Would</span> you like to continue? (y/n) <span class="ex">y</span>
<span class="ex">Cleaning</span> users...
<span class="ex">Done.</span>
<span class="ex">Cleaning</span> sessions...
<span class="ex">Vacuuming</span> OmniDB database...
<span class="ex">Done.</span>
<span class="ex">Vacuuming</span> Sessions database...
<span class="ex">Done.</span></code></pre></div>
</body>
</html>
